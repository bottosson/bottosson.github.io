<!DOCTYPE html><html domain="github.io" ga-id="UA-184527855-1" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="default-src 'self' ; object-src 'none' ; script-src 'self' 'sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=' https://www.google-analytics.com https://ssl.google-analytics.com ; style-src 'unsafe-inline' ; img-src 'self' data: https://www.google-analytics.com ; connect-src https://www.google-analytics.com" http-equiv="Content-Security-Policy"><link href="/img/favicon/favicon-32x32.png?hash=d763fc1b07" rel="icon" sizes="32x32" type="image/png"><link href="/img/favicon/favicon-16x16.png?hash=ee8f8c9160" rel="icon" sizes="16x16" type="image/png"><link href="/img/favicon/favicon-192x192.png?hash=98293e6f87" rel="icon" sizes="192x192" type="image/png"><link href="/img/favicon/favicon-192x192.png?hash=98293e6f87" rel="icon" sizes="512x512" type="image/png"><link href="/img/favicon/apple-touch-icon.png?hash=624ca04e47" rel="apple-touch-icon" sizes="180x180"><meta content="#FFFFFF" name="theme-color"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>Two new color spaces for color picking - Okhsv and Okhsl</title><meta content="Two new color spaces for color picking - Okhsv and Okhsl" property="og:title"><meta content="Okhsv and Okhsl Two new color spaces for color picking This post has an accompanying interactive comparison of color pickers. I would..." name="description"><meta content="Okhsv and Okhsl Two new color spaces for color picking This post has an accompanying interactive comparison of color pickers. I would..." property="og:description"><meta content="@bjornornorn" name="twitter:site"><meta content="@bjornornorn" name="twitter:creator"><link href="https://bottosson.github.io/posts/colorpicker/" rel="canonical"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Björn Ottosson"><link href="/" rel="preconnect" crossorigin=""><script async="" defer="" src="/js/min.js?hash=b945678541"></script><script async="" defer="" src="https://ssl.google-analytics.com/analytics.js"></script><script csp-hash="sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>.content img{display:block;margin-left:auto;margin-right:auto}main img{content-visibility:auto}header nav{z-index:1}:root{--main-width: calc(100vw - 3em)}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}#posts li{margin-bottom:.5em}.anchor-link{fill:#d9d9d9;stroke:none}.anchor-link:active,.anchor-link:hover{fill:#4a4a4a}
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}details,main{display:block}h1{font-size:2em;margin:.67em 0}button,hr{overflow:visible}hr{box-sizing:content-box;height:0}code,pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}b,strong{font-weight:bolder}small{font-size:80%}img{border-style:none}button{font-family:inherit;font-size:100%;line-height:1.15;margin:0;text-transform:none}[type=button],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}summary{display:list-item}
/*! bulma.io v0.9.1 | MIT License | github.com/jgthms/bulma */
@-webkit-keyframes spinAround{0%{transform:rotate(0deg)}to{transform:rotate(359deg)}}@keyframes spinAround{0%{transform:rotate(0deg)}to{transform:rotate(359deg)}}.button{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-moz-appearance:none;-webkit-appearance:none;align-items:center;border:1px solid transparent;border-radius:4px;box-shadow:none;display:inline-flex;font-size:1rem;height:2.5em;justify-content:flex-start;line-height:1.5;padding:calc(.5em - 1px) calc(.75em - 1px);position:relative;vertical-align:top}.box:not(:last-child),.content:not(:last-child),.table:not(:last-child),.title:not(:last-child){margin-bottom:1.5rem}.button:active,.button:focus,.is-active.button{outline:0}
/*! minireset.css v0.0.6 | MIT License | github.com/jgthms/minireset.css */
@-webkit-keyframes moveIndeterminate{0%{background-position:200% 0}to{background-position:-200% 0}}@keyframes moveIndeterminate{0%{background-position:200% 0}to{background-position:-200% 0}}blockquote,body,h1,h2,h3,h4,hr,html,li,p,pre,ul{margin:0;padding:0}h1,h2,h3,h4{font-size:100%;font-weight:400}ul{list-style:none}button{margin:0}html{box-sizing:border-box;background-color:#fff;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;min-width:300px;overflow-x:hidden;overflow-y:scroll;text-rendering:optimizeLegibility;-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%}*,::after,::before{box-sizing:inherit}img{height:auto;max-width:100%}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.content table th:not([align]),table td:not([align]),table th:not([align]),td:not([align]),th:not([align]){text-align:inherit}article,header,hr,section{display:block}body,button{font-family:BlinkMacSystemFont,-apple-system,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue","Helvetica","Arial",sans-serif}code,pre{-moz-osx-font-smoothing:auto;-webkit-font-smoothing:auto;font-family:monospace}body,code{font-weight:400}body{font-size:1em;line-height:1.5}a{color:#3273dc;cursor:pointer;text-decoration:none}a strong,pre code{color:currentColor}a:hover,strong{color:#363636}code{color:#da1039;padding:.25em .5em}hr{border:0;height:2px;margin:1.5rem 0}code,small{font-size:.875em}span{font-style:inherit;font-weight:inherit}strong{font-weight:700}.box,body,pre{color:#4a4a4a}code,hr,pre{background-color:#f5f5f5}pre{-webkit-overflow-scrolling:touch;font-size:.875em;overflow-x:auto;padding:1.25rem 1.5rem;white-space:pre;word-wrap:normal}pre code{background-color:transparent;font-size:1em;padding:0}table td,table th{vertical-align:top}table th{color:#363636}.box{background-color:#fff;border-radius:6px;box-shadow:0 .5em 1em -.125em rgba(10,10,10,.1),0 0 0 1px rgba(10,10,10,.02);display:block;padding:1.25rem}a.box:focus,a.box:hover{box-shadow:0 .5em 1em -.125em rgba(10,10,10,.1),0 0 0 1px #3273dc}a.box:active{box-shadow:inset 0 1px 2px rgba(10,10,10,.2),0 0 0 1px #3273dc}.button{background-color:#fff;border-color:#dbdbdb;border-width:1px;color:#363636;cursor:pointer;justify-content:center;padding-bottom:calc(.5em - 1px);padding-left:1em;padding-right:1em;padding-top:calc(.5em - 1px);text-align:center;white-space:nowrap}.button strong{color:inherit}.button .icon,.button .icon.is-medium,.button .icon.is-small{height:1.5em;width:1.5em}.button .icon:first-child:not(:last-child){margin-left:calc(-.5em - 1px);margin-right:.25em}.button .icon:last-child:not(:first-child){margin-left:.25em;margin-right:calc(-.5em - 1px)}.button .icon:first-child:last-child{margin-left:calc(-.5em - 1px);margin-right:calc(-.5em - 1px)}.button:hover{border-color:#b5b5b5;color:#363636}.button:focus{border-color:#3273dc;color:#363636}.button:focus:not(:active){box-shadow:0 0 0 .125em rgba(50,115,220,.25)}.button.is-active,.button:active{border-color:#4a4a4a;color:#363636}.button.is-white,.button.is-white:hover{background-color:#fff;border-color:transparent;color:#0a0a0a}.button.is-white:hover{background-color:#f9f9f9}.button.is-white:focus{border-color:transparent;color:#0a0a0a}.button.is-white:focus:not(:active){box-shadow:0 0 0 .125em rgba(255,255,255,.25)}.button.is-white.is-active,.button.is-white:active{background-color:#f2f2f2;border-color:transparent;color:#0a0a0a}.button.is-small{border-radius:2px;font-size:.75rem}.button.is-medium{font-size:1.25rem}.buttons{align-items:center;display:flex;flex-wrap:wrap;justify-content:flex-start}.buttons .button{margin-bottom:.5rem}.buttons .button:not(:last-child):not(.is-fullwidth){margin-right:.5rem}.buttons:last-child{margin-bottom:-.5rem}.buttons:not(:last-child){margin-bottom:1rem}.container{flex-grow:1;margin:0 auto;position:relative;width:auto}@media screen and (min-width:1024px){.container{max-width:960px}}@media screen and (min-width:1216px){.container:not(.is-max-desktop){max-width:1152px}}@media screen and (min-width:1408px){.container:not(.is-max-desktop):not(.is-max-widescreen){max-width:1344px}}.content li+li{margin-top:.25em}.content blockquote:not(:last-child),.content p:not(:last-child),.content pre:not(:last-child),.content table:not(:last-child),.content ul:not(:last-child){margin-bottom:1em}.content h1,.content h2,.content h3,.content h4{color:#363636;font-weight:600;line-height:1.125}.content h1{font-size:2em;margin-bottom:.5em}.content h1:not(:first-child){margin-top:1em}.content h2{font-size:1.75em;margin-bottom:.5714em}.content h2:not(:first-child){margin-top:1.1428em}.content h3{font-size:1.5em;margin-bottom:.6666em}.content h3:not(:first-child){margin-top:1.3333em}.content h4{font-size:1.25em;margin-bottom:.8em}.content blockquote{background-color:#f5f5f5;border-left:5px solid #dbdbdb;padding:1.25em 1.5em}.content ul{list-style:disc outside;margin-left:2em;margin-top:1em}.content ul ul{list-style-type:circle;margin-top:.5em}.content ul ul ul{list-style-type:square}.content pre{-webkit-overflow-scrolling:touch;overflow-x:auto;padding:1.25em 1.5em;white-space:pre;word-wrap:normal}.content table{width:100%}.content table td,.content table th,.table td,.table th{border:1px solid #dbdbdb;border-width:0 0 1px;padding:.5em .75em;vertical-align:top}.content table th,.table th{color:#363636}.content table thead td,.content table thead th,.table thead td,.table thead th{border-width:0 0 2px;color:#363636}.content table tbody tr:last-child td,.content table tbody tr:last-child th,.table tbody tr:last-child td,.table tbody tr:last-child th{border-bottom-width:0}.content.is-small{font-size:.75rem}.content.is-medium{font-size:1.25rem}.icon{align-items:center;display:inline-flex;justify-content:center;height:1.5rem;width:1.5rem}.icon.is-small{height:1rem;width:1rem}.icon.is-medium{height:2rem;width:2rem}.image{display:block;position:relative}.image img{display:block;height:auto;width:100%}.table{background-color:#fff;color:#363636}.table td.is-white,.table th.is-white{background-color:#fff;border-color:#fff;color:#0a0a0a}.table th:not([align]){text-align:inherit}.table tbody,.table thead{background-color:transparent}.title{word-break:break-word;color:#363636;font-size:2rem;font-weight:600;line-height:1.125}.title em,.title span,.title strong{font-weight:inherit}.title strong{color:inherit}.control{box-sizing:border-box;clear:both;font-size:1rem;position:relative;text-align:inherit}.navbar{background-color:#fff;min-height:3.25rem;position:relative;z-index:30}.navbar.is-white{background-color:#fff;color:#0a0a0a}.navbar.is-white .navbar-brand>.navbar-item,.navbar.is-white .navbar-burger{color:#0a0a0a}.navbar.is-white .navbar-brand>a.navbar-item.is-active,.navbar.is-white .navbar-brand>a.navbar-item:focus,.navbar.is-white .navbar-brand>a.navbar-item:hover{background-color:#f2f2f2;color:#0a0a0a}@media screen and (min-width:1024px){.navbar.is-white .navbar-end>.navbar-item{color:#0a0a0a}.navbar.is-white .navbar-end>a.navbar-item.is-active,.navbar.is-white .navbar-end>a.navbar-item:focus,.navbar.is-white .navbar-end>a.navbar-item:hover{background-color:#f2f2f2;color:#0a0a0a}}.navbar-brand,.navbar>.container{align-items:stretch;display:flex;min-height:3.25rem}.navbar>.container{width:100%}.navbar.has-shadow{box-shadow:0 2px 0 0 #f5f5f5}.navbar.is-fixed-top{left:0;position:fixed;right:0;z-index:30;top:0}body.has-navbar-fixed-top,html.has-navbar-fixed-top{padding-top:3.25rem}.navbar-brand{flex-shrink:0}.navbar-brand a.navbar-item:focus,.navbar-brand a.navbar-item:hover{background-color:transparent}.navbar-burger{color:#4a4a4a;cursor:pointer;display:block;height:3.25rem;position:relative;width:3.25rem;margin-left:auto}.navbar-burger span{background-color:currentColor;display:block;height:1px;left:calc(50% - 8px);position:absolute;transform-origin:center;transition-duration:86ms;transition-property:background-color,opacity,transform;transition-timing-function:ease-out;width:16px}.navbar-burger span:nth-child(1){top:calc(50% - 6px)}.navbar-burger span:nth-child(2){top:calc(50% - 1px)}.navbar-burger span:nth-child(3){top:calc(50% + 4px)}.navbar-burger:hover{background-color:rgba(0,0,0,.05)}.navbar-burger.is-active span:nth-child(1){transform:translateY(5px) rotate(45deg)}.navbar-burger.is-active span:nth-child(2){opacity:0}.navbar-burger.is-active span:nth-child(3){transform:translateY(-5px) rotate(-45deg)}.navbar-menu{display:none}.navbar-item{color:#4a4a4a;display:block;line-height:1.5;padding:.5rem .75rem;position:relative;flex-grow:0;flex-shrink:0}.navbar-item .icon:only-child{margin-left:-.25rem;margin-right:-.25rem}a.navbar-item{cursor:pointer}a.navbar-item.is-active,a.navbar-item:focus,a.navbar-item:focus-within,a.navbar-item:hover{background-color:#fafafa;color:#3273dc}.navbar-item img{max-height:1.75rem}.navbar-item.is-tab{border-bottom:1px solid transparent;min-height:3.25rem;padding-bottom:calc(.5rem - 1px)}.navbar-item.is-tab:focus,.navbar-item.is-tab:hover{background-color:transparent;border-bottom-color:#3273dc}.navbar-item.is-tab.is-active{background-color:transparent;border-bottom-color:#3273dc;border-bottom-style:solid;border-bottom-width:3px;color:#3273dc;padding-bottom:calc(.5rem - 3px)}@media screen and (max-width:1023px){.navbar>.container{display:block}.navbar-brand .navbar-item{align-items:center;display:flex}.navbar-menu{background-color:#fff;box-shadow:0 8px 16px rgba(10,10,10,.1);padding:.5rem 0}.navbar-menu.is-active{display:block}.navbar.is-fixed-top .navbar-menu{-webkit-overflow-scrolling:touch;max-height:calc(100vh - 3.25rem);overflow:auto}}@media screen and (min-width:1024px){.navbar,.navbar-end,.navbar-menu{align-items:stretch;display:flex}.navbar{min-height:3.25rem}.navbar-burger{display:none}.navbar-item{align-items:center;display:flex}.navbar-menu{flex-grow:1;flex-shrink:0}.navbar-end{justify-content:flex-end;margin-left:auto}.container>.navbar .navbar-brand,.navbar>.container .navbar-brand{margin-left:-.75rem}.container>.navbar .navbar-menu,.navbar>.container .navbar-menu{margin-right:-.75rem}a.navbar-item.is-active{color:#0a0a0a}a.navbar-item.is-active:not(:focus):not(:hover){background-color:transparent}}.column{display:block;flex-basis:0;flex-grow:1;flex-shrink:1;padding:.75rem}@media screen and (min-width:769px),print{.column.is-half{flex:none;width:50%}.column.is-one-third{flex:none;width:33.3333%}}.columns{margin-left:-.75rem;margin-right:-.75rem;margin-top:-.75rem}.columns:last-child{margin-bottom:-.75rem}.columns:not(:last-child){margin-bottom:calc(1.5rem - .75rem)}@media screen and (min-width:769px),print{.columns:not(.is-desktop){display:flex}}.has-background-grey-light{background-color:#b5b5b5!important}.has-background-white-ter{background-color:#f5f5f5!important}.is-size-3{font-size:2rem!important}.is-size-5{font-size:1.25rem!important}.has-text-weight-semibold{font-weight:600!important}.section{padding:3rem 1.5rem}@media screen and (min-width:1024px){.section.is-medium{padding:9rem 1.5rem}}@font-face{font-family:KaTeX_Math;src:url(/fonts/KaTeX_Math-Italic.eot);src:url(/fonts/KaTeX_Math-Italic.eot#iefix) format('embedded-opentype'),url(/fonts/KaTeX_Math-Italic.woff2) format('woff2'),url(/fonts/KaTeX_Math-Italic.woff) format('woff'),url(/fonts/KaTeX_Math-Italic.ttf) format('ttf');font-weight:400;font-style:italic}@font-face{font-family:KaTeX_Size1;src:url(/fonts/KaTeX_Size1-Regular.eot);src:url(/fonts/KaTeX_Size1-Regular.eot#iefix) format('embedded-opentype'),url(/fonts/KaTeX_Size1-Regular.woff2) format('woff2'),url(/fonts/KaTeX_Size1-Regular.woff) format('woff'),url(/fonts/KaTeX_Size1-Regular.ttf) format('ttf');font-weight:400;font-style:normal}.katex-display{display:block;margin:1em 0;text-align:center}.katex .katex-html,.katex-display>.katex{display:inline-block}.katex{font:400 1.21em KaTeX_Main;line-height:1.2;white-space:nowrap;text-indent:0}.katex .katex-mathml{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}.katex .base,.katex .strut{display:inline-block}.katex .mathit{font-family:KaTeX_Math;font-style:italic}.katex .textstyle>.mord+.mbin{margin-left:.22222em}.katex .textstyle>.mord+.mrel{margin-left:.27778em}.katex .textstyle>.mbin+.mopen,.katex .textstyle>.mbin+.mord{margin-left:.22222em}.katex .textstyle>.mrel+.mopen,.katex .textstyle>.mrel+.mord{margin-left:.27778em}.katex .textstyle>.mclose+.mbin{margin-left:.22222em}.katex .textstyle>.mclose+.mrel{margin-left:.27778em}.katex .textstyle>.mpunct+.mclose,.katex .textstyle>.mpunct+.mopen,.katex .textstyle>.mpunct+.mord,.katex .textstyle>.mpunct+.mpunct,.katex .textstyle>.mpunct+.mrel{margin-left:.16667em}.katex .reset-textstyle.textstyle{font-size:1em}.katex .reset-textstyle.scriptstyle{font-size:.7em}.katex .style-wrap{position:relative}.katex .fontsize-ensurer,.katex .mspace,.katex .sizing,.katex .vlist,.katex .vlist>span>span{display:inline-block}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist .baseline-fix{display:inline-table;table-layout:fixed}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{width:100%}.katex .mfrac .frac-line:after,.katex .mfrac .frac-line:before{border-bottom-style:solid;border-bottom-width:1px;content:"";display:block}.katex .mfrac .frac-line:after{border-bottom-width:.04em;margin-top:-1px}.katex .mspace.qquad{width:2em}.katex .sqrt>.sqrt-sign{position:relative}.katex .sqrt .sqrt-line{width:100%}.katex .sqrt .sqrt-line:after,.katex .sqrt .sqrt-line:before{border-bottom-style:solid;border-bottom-width:1px;content:"";display:block}.katex .sqrt .sqrt-line:after{border-bottom-width:.04em;margin-top:-1px}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .nulldelimiter{display:inline-block;width:.12em}.resp-sharing-button__icon{stroke:#fff;fill:none}.resp-sharing-button__icon--solid{fill:#fff;stroke:none}.resp-sharing-button--hackernews:focus,.resp-sharing-button--hackernews:hover{background-color:#fb6200}.resp-sharing-button--facebook{background-color:#3b5998;border-color:#3b5998}.resp-sharing-button--facebook:active,.resp-sharing-button--facebook:hover{background-color:#2d4373;border-color:#2d4373}.resp-sharing-button--twitter{background-color:#55acee;border-color:#55acee}.resp-sharing-button--twitter:active,.resp-sharing-button--twitter:hover{background-color:#2795e9;border-color:#2795e9}.resp-sharing-button--email{background-color:#777;border-color:#777}.resp-sharing-button--email:active,.resp-sharing-button--email:hover{background-color:#5e5e5e;border-color:#5e5e5e}.resp-sharing-button--linkedin{background-color:#0077b5;border-color:#0077b5}.resp-sharing-button--linkedin:active,.resp-sharing-button--linkedin:hover{background-color:#046293;border-color:#046293}.resp-sharing-button--reddit{background-color:#5f99cf;border-color:#5f99cf}.resp-sharing-button--reddit:active,.resp-sharing-button--reddit:hover{background-color:#3a80c1;border-color:#3a80c1}.resp-sharing-button--hackernews{background-color:#f60;border-color:#f60}.resp-sharing-button--hackernews:hover .resp-sharing-button--hackernews:active{background-color:#fb6200;border-color:#fb6200}code[class*=language-],pre[class*=language-]{color:#5c6e74;font-size:13px;text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::mozselection,code[class*=language-]::selection,pre[class*=language-]::mozselection,pre[class*=language-]::selection{text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}.token.comment{color:#93a1a1}.token.punctuation{color:#999}.token.constant,.token.number,.token.property{color:#905}.token.inserted{color:#690}.token.operator,.token.url{color:#a67f59}.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important{color:#e90;font-weight:700}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}</style></head><body class="has-navbar-fixed-top"><header class="container is-max-desktop"><nav class="has-shadow is-fixed-top navbar"><div class="container"><div class="navbar-brand"><a href="/" class="navbar-item has-text-weight-semibold is-size-3">Björn Ottosson </a><a class="navbar-burger" data-target="navMenu" role="button"><span></span> <span></span> <span></span></a></div><div class="navbar-menu" id="navMenu"><div class="is-active navbar-end"><a href="/" class="navbar-item has-text-weight-semibold is-size-5 is-tab">Blog </a><a href="/about/" class="navbar-item has-text-weight-semibold is-size-5 is-tab">About</a><div class="navbar-item"><div class="buttons"><a href="https://twitter.com/bjornornorn" class="is-small button is-white" rel="noopener" target="_blank"><span class="icon"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24" role="img"><title>Twitter icon</title><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z" style="fill:hsl(0, 0%, 29%)"></path></svg> </span></a><a href="https://www.linkedin.com/in/bjorn-ottosson" class="is-small button is-white" rel="noopener" target="_blank"><span class="icon"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24" role="img"><title>LinkedIn icon</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" style="fill:hsl(0, 0%, 29%)"></path></svg></span></a></div></div></div></div></div></nav></header><main class="container is-max-desktop"><article class="section"><div class="content is-medium"><h1 style="margin:0px; font-size: 2.5em;"><p>Okhsv and Okhsl</p></h1><h4 id="two-new-color-spaces-for-color-picking">Two new color spaces for color picking <a href="#two-new-color-spaces-for-color-picking" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h4><blockquote><p><em>This post has an accompanying <a href="http://bottosson.github.io/misc/colorpicker">interactive comparison of color pickers</a></em>.</p><p><em>I would recommend checking out the interactive demo first, then return if you are interested in the background and technical details.</em></p></blockquote><p>Picking colors is a common operation in many applications and over the years color pickers have become fairly standardized. Ubiquitous today are color pickers based on <a href="https://en.wikipedia.org/wiki/HSL_and_HSV">HSL and HSV</a>. They are simple transformations of RGB values to alternative coordinates chosen to better correlate with perceptual qualities.</p><p>Here are two common variants of color pickers built on HSL and HSV:</p><div class="columns"><div class="column has-background-white-ter is-one-third"><p><img alt="HSV Color Picker" decoding="async" height="283" loading="lazy" src="/img/colorpicker/hsv-picker.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 337px) min(calc(var(--main-width) * 0.8397626112759644), 283px);" width="337"></p><p>A HSV color picker.</p></div><div class="column has-background-white-ter is-one-third"><p><img alt="HSL Color Picker" decoding="async" height="283" loading="lazy" src="/img/colorpicker/hsl-picker.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 342px) min(calc(var(--main-width) * 0.827485380116959), 283px);" width="342"></p><p>A HSL color picker.</p></div></div><p>Despite color picking playing a big role in a lot of applications, the design of color pickers isn’t a particularly well researched topic. While some variation exist in the widgets themselves, the choice of HSL or HSV is mostly taken for granted, with only a few exceptions.</p><p>Is their dominance well deserved or would it be possible to create better alternatives? I at least think that this question deserves to be explored and that color picker design should be an active research topic. With this post I hope to contribute to the exploration of what a better color picker could and should be, and hopefully inspire others to do the same!</p><p>The main focus here will be on the choice of color space, rather than the design of the UI widget used for navigating the color space.</p><blockquote><p>This rest of this post is organized as follow:</p><ul><li>A brief history of color picking</li><li>What are meaningful properties of color spaces for color picking?</li><li>What options exist already and how do they perform?</li><li>Introducing two new color spaces: Okhsl and Okhsv</li><li>Ideas for future work</li></ul></blockquote><h2 id="color-picking-before-computers">Color picking before computers <a href="#color-picking-before-computers" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h2><div style="float:right;width:300px;padding:15px"><div class="box has-background-white-ter"><p><img alt="Munsell Color System" decoding="async" height="768" loading="lazy" src="/img/colorpicker/846px-Munsell_color-tree_hg.jpg" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 846px) min(calc(var(--main-width) * 0.9078014184397163), 768px);" width="846"></p><p>Munsell Color System. Photo by Hannes Grobe, license <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en">CC BY-SA 4.0</a></p></div><div class="box has-background-white-ter"><p><img alt="Natural Color System" decoding="async" height="1517" loading="lazy" src="/img/colorpicker/ncs_color_picker.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 1241px) min(calc(var(--main-width) * 1.2224012892828364), 1517px);" width="1241"></p><p>Example of NCS color picker. Screenshot from NCS Navigator in the <a href="https://ncscolour.com/colourpin/">Colourpin</a> app.</p></div></div><p>Categorizing, describing and picking colors is an old problem and predates computers by many centuries. Over the years countless artists and scientists have worked to understand how humans perceive colors and used that knowledge to try and create practical systems for describing colors. Many different color ordering systems have been created over the years based on mixing properties of paints, light or on perceptual qualities.</p><p>During the 20th century two important color systems emerged. The <a href="https://en.wikipedia.org/wiki/Munsell_color_system">Munsell Color System</a> and the <a href="https://en.wikipedia.org/wiki/Natural_Color_System">Natural Color System (NCS)</a>. Both of them are based on human perception and were derived using experiments, but with different approaches. The two systems are used in many practical applications today still.</p><p>In the Munsell color system, colors are described with three parameters, designed to match the perceived appearance of colors: Hue, Chroma and Value. The parameters are designed to be independent and each have a uniform scale. This results in a color solid with an irregular shape. Modern color spaces and models, such as <a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELAB</a>, <a href="https://en.wikipedia.org/wiki/Color_appearance_model#CAM16">Cam16</a> and my own <a href="https://bottosson.github.io/posts/oklab/">Oklab</a>, are very similar in their construction.</p><p>The Natural Color System takes a different approach, and is designed to make it easy to describe colors, rather than to match perceptual qualities. It does this by describing colors by their similarity to six primary colors: white, black, yellow, red, green and blue. The yellow, red, green and blue colors are used to determine the hue. The final color is described by a color triangle with the corners white, black and the most saturated color of the given hue. A position in the triangle is described with the parameters whiteness, blackness, chromaticness. Any two of those parameters are sufficient, since they sum to one.</p><p>For more information about historical color systems, this is a great resource: <a href="http://www.colorsystem.com/?lang=en">colorsystem.com</a>.</p><h2 id="what-makes-a-good-color-picker%3F">What makes a good color picker? <a href="#what-makes-a-good-color-picker%3F" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h2><p>Before diving into how color pickers have evolved in the digital era, let’s look a bit further at what considerations can be relevant when designing a color space for color picking. This part assumes familiarity with color appearance concepts such as <a href="https://en.wikipedia.org/wiki/Lightness">lightness</a>, <a href="https://en.wikipedia.org/wiki/Colorfulness">chroma, saturation</a> and <a href="https://en.wikipedia.org/wiki/Hue">hue</a>.</p><p>In this post the focus will be on what is today the most common case, picking colors in the <a href="https://en.wikipedia.org/wiki/sRGB">sRGB</a> gamut. Wide gamut and HDR displays are becoming more common and will be increasingly important, so wide gamut and HDR color picking is definitely a topic for further research and development, but it will not be considered here.</p><p>Here’s an attempt at capturing useful properties for color spaces designed for picking colors:</p><ul><li><strong>Orthogonal Lightness</strong> - Hue/Chroma/Saturation can be altered, while keeping perceived Lightness constant</li><li><strong>Orthogonal Chroma</strong> - Lightness/Hue can be altered, while keeping perceived Chroma constant</li><li><strong>Orthogonal Saturation</strong> - Lightness/Hue can be altered, while keeping perceived Saturation constant</li><li><strong>Orthogonal Hue</strong> - Lightness/Chroma/Saturation can be altered, while keeping perceived Hue constant</li><li><strong>Simple Geometrical Shape</strong> - Fit the target gamut into a cylinder or other simple shape, so that parameters can be altered independently without resulting in colors outside the target gamut. Could also be a swept triangle like NCS, since it is simple to map back and forth to a cylinder.</li><li><strong>Max Chroma at edge</strong> - Make it easy to find the strongest color of a given hue, by placing the strongest color on edge of the color volume.</li><li><strong>Varies Smoothly</strong> - Vary smoothly with each parameter. No discontinuous or abrupt changes.</li><li><strong>Varies Evenly</strong> - The perceived magnitude of the change in color caused by changing a parameter should be uniform for all values of the parameter.</li></ul><p><strong>Note:</strong> These properties are in conflict, so designing a color space for color picking is a about finding which tradeoffs to make. In particular, independent control of hue, lightness and chroma can not be achieved in a color space that also maps sRGB to a simple geometrical shape.</p><h2 id="color-spaces-for-color-picking">Color spaces for color picking <a href="#color-spaces-for-color-picking" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h2><p>By far the most used color spaces today for color picking are <a href="https://en.wikipedia.org/wiki/HSL_and_HSV">HSL and HSV</a>, two representations introduced in the classic 1978 paper <a href="https://doi.org/10.1145/800248.807362">“Color Spaces for Computer Graphics”</a>. HSL and HSV designed to roughly correlate with perceptual color properties while being very simple and cheap to compute.</p><p>Worth noting is that HSL and HSV are not quite color spaces on their own, they are transformations from a source RGB color space. For each set of RGB primaries and transfer functions, the transformation to HSL and HSV produces unique color spaces. Today HSL and HSV are most commonly used together with the sRGB color space, so that is what we will look at here and we will here use HSL and HSV to refer to HSL and HSV for the sRGB color space.</p><p>Also useful to note is that HSL and HSV are not continuously differentiable, so that limits their use with numerical optimization and machine learning.</p><h3 id="hsv">HSV <a href="#hsv" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>HSV describes colors with three parameters:</p><ul><li><strong>"Hue"</strong> - Roughly corresponds to perceived hue, but it has quite severe distortions.</li><li><strong>"Saturation"</strong> - Roughly corresponds to saturation relative to maximum possible saturation in sRGB of the same hue.</li><li><strong>"Value"</strong> - A bit hard to define. Can be seen as how much to mix the color with black, with 100% being no black and 0% completely black. “Value” is sometimes also referred to as Brightness.</li></ul><p>HSV is quite similar to the Natural Color System in its structure and it’s possible to transform it to have parameters more similar to NCS, then referred to as <a href="https://en.wikipedia.org/wiki/HWB_color_model">hue, whiteness and blackness (HWB)</a>. After that transformation the largest difference compared with NCS are:</p><ul><li>NCS is derived based on research into the appearance of colors and does a good job at matching human perception</li><li>HWB/HSV has a simple construction, not taking research into color appearance into account and is not matching perception closely. Hue is the most problematic.</li><li>NCS has a gamut designed to contain pigments realizable in paint/print</li><li>HWB/HSV has a gamut based on the RGB color space it is constructed from (most commonly sRGB)</li></ul><div class="columns"><div class="column has-background-white-ter is-one-third"><div class="box has-background-grey-light"><p><img alt="HSV Blue Plot" decoding="async" height="257" loading="lazy" src="/img/colorpicker/hsv_blue.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>Example of hue distortion for deep blue colors. Notice the purple shift as saturation decreases.</p></div></div><h3 id="hsl">HSL <a href="#hsl" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>HSV describes colors with three parameters:</p><ul><li><strong>"Hue"</strong> - Identical to “hue” in HSV, with the same issues.</li><li><strong>"Saturation"</strong> - Roughly the chroma of the color relative to the most colorful color with the same “lightness” and “hue”. Confusingly referred to as saturation, which it is not comparable to. In the original paper it was referred to as “relative chroma”, which is more accurate. Not the same as “saturation” in HSV.</li><li><strong>"Lightness"</strong> - Some correlation with the perception of lightness, with 0% corresponding to black and 100% to white. Does not match the perception of lightness well at all for saturated colors. Referred to as “Intensity” in the original paper.</li></ul><div class="columns"><div class="column has-background-white-ter is-one-third"><div class="box has-background-grey-light"><p><img alt="HSL Blue Plot" decoding="async" height="257" loading="lazy" src="/img/colorpicker/hsl_blue.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>Example of hue distortion for deep blue colors.</p></div><div class="column has-background-white-ter is-one-third"><div class="box has-background-grey-light"><p><img alt="HSL Constant Lightness" decoding="async" height="257" loading="lazy" src="/img/colorpicker/hsl_ligthness.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>Example of colors HSL considers to have the same lightness.</p></div></div><h3 id="hsluv">HSLuv <a href="#hsluv" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p><a href="https://www.hsluv.org/">HSLuv</a> is a recent development to tackle some of the shortcomings of HSL. It is based on <a href="https://en.wikipedia.org/wiki/CIELUV">CIELChuv</a>, a cylindrical form of 1976 CIE color space CIELUV. CIELChuv is constructed so that for a given hue, all colors of that hue can be constructed by additive blending of white and a saturated color of that hue (and in general, additive blending of light forms straight lines in CIELuv).</p><p>HSLuv describes colors with three parameters:</p><ul><li><strong>"Hue"</strong> - Same as hue in CIELChuv. Does not match the perception of hue fully due to the <a href="https://en.wikipedia.org/wiki/Abney_effect">Abney effect</a>: the perception of hue does not correspond to additive blending.</li><li><strong>"Saturation"</strong> - Based on chroma as defined in CIELChuv, but rescaled to be relative to the most saturated sRGB color of the same “lightness” and “hue”.</li><li><strong>"Lightness"</strong> - Same as lightness in CIELChuv. Does a good job at matching perceived lightness.</li></ul><p>Two drawback with HSLuv are:</p><ul><li>Does not match perception of hue. This is particularly obvious for deep blue and purple colors.</li><li>The way “Saturation” is defined, it does not vary smoothly due to the uneven shape of the sRGB gamut. E.g. by keeping “Saturation” constant and changing hue, the perceived chroma can change drastically and abruptly.</li></ul><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="HSLuv Blue Plot" decoding="async" height="257" loading="lazy" src="/img/colorpicker/hsluv_blue.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>Example of hue distortion for blue colors. The distortion in HSLuv is different from that in sRGB and is caused by the <a href="https://en.wikipedia.org/wiki/Abney_effect">Abney effect</a>.</p></div><div class="column"><div class="box has-background-grey-light"><p><img alt="HSLuv Constant Lightness" decoding="async" height="257" loading="lazy" src="/img/colorpicker/hsluv_uneven_s_circle.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>Example of constant lightness in HSLuv, with low “saturation” close to the center of the circle and maximum “saturation” at the edge. Notice how the blue and red hues are much more saturated than surrounding colors.</p></div><div class="column"><div class="box has-background-grey-light"><p><img alt="HSLuv Constant Saturation" decoding="async" height="257" loading="lazy" src="/img/colorpicker/hsluv_uneven_s_slice.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>Slice of colors with constant “saturation” in HSLuv. The scaling to match the uneven shape of the sRGB gamut makes the perceived chroma vary unevenly.</p></div></div><h3 id="color-spaces-modelling-color-appearance">Color spaces modelling color appearance <a href="#color-spaces-modelling-color-appearance" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>While there is a limited amount of research done regarding color picking, a lot of work has been done to create color models that are able to predict color appearance. These continue in the tradition of the Munsell color model discussed above, but use more modern color science and mathematical models to better model the appearance of color. One of the most famous of these is <a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELab</a>, but there are today several new models that perform better.</p><p>Comparing all the color models is beyond the scope of this post, the important conclusion here is that these models can model the perception of Lightness, Hue and Chroma much better than all the previously discussed options. For a brief overview of some of the more recent models, see my previous post <a href="https://bottosson.github.io/posts/oklab/">“A perceptual color space for image processing”</a>. Since then another color model has also appeared: <a href="https://doi.org/10.1364/OE.413659">ZCAM</a>. For a much deeper overview of modern color science and different attempts at modeling color appearance, I recommend the book <a href="http://markfairchild.org/CAM.html">“Color Appearance Models”</a> by Mark D. Fairchild.</p><p>The main drawback of using these models directly for color picking is that the sRGB gamut has a quite irregular shape in these color spaces. As a result, changing one parameter, such as hue, can easily create a color outside the target gamut, making them quite tedious to use. Several color pickers have been made using either CIELab or more modern lab-like color spaces. From what I can tell they have only seen limited use compared with the more common HSV and HSL color pickers however.</p><p>I would think that the reason that they haven’t caught on is that their drawbacks outweigh their benefits: using a space with parameters that don’t match the our perception of hue, lightness and chroma is easier than using one with an irregular shape. That is certainly my personal experience.</p><p>For the more advanced models an additional complication is that they have several parameters meant to be adjusted based on the viewing conditions. When used for color picking they seem to mostly be set to match some kind of average viewing conditions though.</p><p>Here are a couple of examples of the irregular shape of the sRGB gamut in a perceptual color space:</p><div class="columns"><div class="column has-background-white-ter is-one-third"><div class="box has-background-grey-light"><p><img alt="Oklrab Blue" decoding="async" height="257" loading="lazy" src="/img/colorpicker/oklrab_blue.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>A slice of the gamut with a constant blue hue.</p></div><div class="column has-background-white-ter is-one-third"><div class="box has-background-grey-light"><p><img alt="Oklrab Yellow" decoding="async" height="257" loading="lazy" src="/img/colorpicker/oklrab_yellow.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>A slice of the gamut with a constant yellow hue.</p></div></div><p>It is unfortunately also common to see CIELab based color pickers showing colors outside the target gamut and often they are mapped back by simply clamping individual RGB components. This creates severe distortions in hue, lightness and chroma, in would would otherwise be a fairly uniform color space.</p><h3 id="summary">Summary <a href="#summary" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>These are the color spaces I am aware of that are relevant, but please reach out if you are aware of any more color spaces useful for color picking.</p><p>To summarize, here is a table of the different color spaces discussed and how they match the different desirable properties. This is definitely a bit subjective, but will hopefully give a decent overview.</p><table><thead><tr><th></th><th>HSV</th><th>HSL</th><th>HSLuv</th><th>Lab-like*</th><th>NCS</th></tr></thead><tbody><tr><td>Orthogonal Lightness</td><td>no</td><td>no</td><td>yes</td><td>yes</td><td>no</td></tr><tr><td>Orthogonal Chroma</td><td>no</td><td>no</td><td>no</td><td>yes</td><td>partial</td></tr><tr><td>Orthogonal Saturation</td><td>partial</td><td>no</td><td>no</td><td>no**</td><td>no</td></tr><tr><td>Orthogonal Hue</td><td>partial</td><td>partial</td><td>partial</td><td>yes</td><td>yes</td></tr><tr><td>Simple Geometrical Shape</td><td>yes</td><td>yes</td><td>yes</td><td>no</td><td>no***</td></tr><tr><td>Max Chroma at Edge</td><td>yes</td><td>no</td><td>no</td><td>yes</td><td>no</td></tr><tr><td>Varies Smoothly</td><td>yes</td><td>yes</td><td>no</td><td>yes</td><td>yes</td></tr><tr><td>Varies Evenly</td><td>no</td><td>no</td><td>no</td><td>yes</td><td>partial</td></tr></tbody></table><blockquote><p><em>*) This of course depends on which Lab-like color space. This is the best possible an appearance modelling color space could achieve.</em><br><em>**) If desirable, saturation can be used instead of Chroma, and then this would be a yes and “Orthogonal Chroma” a no.</em><br><em>***) NCS has a simple geometrical shape, but it does not match the sRGB gamut.</em></p></blockquote><h2 id="finding-a-better-tradeoff">Finding a better tradeoff <a href="#finding-a-better-tradeoff" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h2><p>One of the main advantages of HSL and HSV over the different Lab color spaces is that they map the sRGB gamut to a cylinder. This makes them easy to use since all parameters can be changed independently, without the risk of creating colors outside of the target gamut.</p><p>The main drawback on the other hand is that their properties don’t match human perception particularly well. Reconciling these conflicting goals perfectly isn’t possible, but given that HSV and HSL don’t use anything derived from experiments relating to human perception, creating something that makes a better tradeoff does not seem unreasonable.</p><p>We will attempt to do just that by creating new color spaces similar to HSL and HSV but that better match perception. This will be done by leveraging the Oklab color space. Using Oklab here over more advanced models such as CAM16 is useful because working out the math becomes a lot simpler. It also means that it won’t be a full color model able to adapt to different viewing conditions, but that is probably also desirable here since it is more practical.</p><p>For consistency with the naming of Oklab, these new color spaces will be called Okhsl and Okhsv. The parameters will also be referred to as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">h</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">h</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> respectively. Those names are a bit confusing but I think making the new spaces easy to adopt for someone used to HSL and HSV is more important than trying to establish new names.</p><h2 id="intermission---a-new-lightness-estimate-for-oklab">Intermission - a new lightness estimate for Oklab <a href="#intermission---a-new-lightness-estimate-for-oklab" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h2><p>One design decision with Oklab is to use a design that is scale independent. That is, Oklab has no concept of reference white, unlike CIELab for example. In many cases this is an advantage, since it makes dealing with larger dynamic ranges easier.</p><p>However, in the context of a color picker with well defined dynamic range and a clear reference white luminance it reduces Oklab’s ability to predict lightness. Therefore, an additional lightness estimate is needed to better handle these cases. With a reference white luminance of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.22222em;">Y</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span>, the new lightness estimate <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">L_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> is defined as:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>k</mi><mn>1</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>2</mn><mn>0</mn><mn>6</mn><mo separator="true">,</mo><mspace width="2em"></mspace><msub><mi>k</mi><mn>2</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>3</mn><mo separator="true">,</mo><mspace width="2em"></mspace><msub><mi>k</mi><mn>3</mn></msub><mo>=</mo><mfrac><mrow><mn>1</mn><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub></mrow><mrow><mn>1</mn><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">k_1 = 0.206 ,\qquad k_2 = 0.03 ,\qquad k_3 = \frac{1+k_1}{1+k_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.37144em;"></span><span class="strut bottom" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="textstyle uncramped base displaystyle"><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">2</span><span class="mord mathrm">0</span><span class="mord mathrm">6</span><span class="mpunct">,</span><span class="mord mspace qquad"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">0</span><span class="mord mathrm">3</span><span class="mpunct">,</span><span class="mord mspace qquad"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">3</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord textstyle uncramped reset-textstyle displaystyle"><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle reset-textstyle cramped"><span class="mord cramped textstyle"><span class="mord mathrm">1</span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle uncramped reset-textstyle frac-line"></span></span><span style="top:-0.677em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle uncramped reset-textstyle"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>k</mi><mn>3</mn></msub><mi>L</mi><mo>−</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><msqrt><mrow><mo>(</mo><msub><mi>k</mi><mn>3</mn></msub><mi>L</mi><mo>−</mo><msub><mi>k</mi><mn>1</mn></msub><msup><mo>)</mo><mn>2</mn></msup><mo>+</mo><mn>4</mn><msub><mi>k</mi><mn>2</mn></msub><msub><mi>k</mi><mn>3</mn></msub><mi>L</mi></mrow></msqrt></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">L_r = \frac{k_3 L - k_1 + \sqrt{(k_3 L - k_1)^2 + 4 k_2 k_3 L}} 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.63001em;"></span><span class="strut bottom" style="height:2.31601em;vertical-align:-0.686em;"></span><span class="textstyle uncramped base displaystyle"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord textstyle uncramped reset-textstyle displaystyle"><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:1em;">​</span></span><span class="textstyle reset-textstyle cramped"><span class="mord mathrm">2</span></span></span><span style="top:-0.22999999999999998em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:1em;">​</span></span><span class="textstyle uncramped reset-textstyle frac-line"></span></span><span style="top:-0.6950049999999999em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:1em;">​</span></span><span class="textstyle uncramped reset-textstyle"><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">3</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">L</span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord sqrt"><span class="sqrt-sign" style="top:-0.04500500000000007em;"><span class="textstyle uncramped reset-textstyle style-wrap"><span class="delimsizing size1">√</span></span></span><span class="vlist"><span style="top:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:1em;">​</span></span><span class="mord cramped textstyle"><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">3</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">L</span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.289em;margin-right:0.05em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathrm">4</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">3</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">L</span></span></span><span style="top:-0.855005em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:1em;">​</span></span><span class="textstyle uncramped reset-textstyle sqrt-line"></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:1em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span></span></span></span></span></span></p><p>With the inversion:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>=</mo><mfrac><mrow><msub><mi>L</mi><mi>r</mi></msub><mo>(</mo><msub><mi>L</mi><mi>r</mi></msub><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo>)</mo></mrow><mrow><msub><mi>k</mi><mn>3</mn></msub><mo>(</mo><msub><mi>L</mi><mi>r</mi></msub><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub><mo>)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">L = \frac{L_r (L_r + k_1)}{k_3 (L_r + k_2)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.427em;"></span><span class="strut bottom" style="height:2.363em;vertical-align:-0.936em;"></span><span class="textstyle uncramped base displaystyle"><span class="mord mathit">L</span><span class="mrel">=</span><span class="mord textstyle uncramped reset-textstyle displaystyle"><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle reset-textstyle cramped"><span class="mord cramped textstyle"><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">3</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span><span style="top:-0.2300000000000001em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle uncramped reset-textstyle frac-line"></span></span><span style="top:-0.677em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle uncramped reset-textstyle"><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03148em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span></span></span></span></span></span></p><p>This new lightness estimate closely matches the lightness estimate of CIELab overall and is nearly equal at 50% lightness (Y for CIELab L is 0.18406, and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">L_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 0.18419) which is useful for compatibility. Worth noting is that it is not possible to have a lightness scale that is perfectly uniform independent of viewing conditions and background color. This new lightness function is however a better tradeoff for cases with a well defined reference white.</p><div class="columns"><div class="column has-background-white-ter is-half"><div class="box has-background-grey-light"><p><img alt="Lightness comparison" decoding="async" height="384" loading="lazy" src="/img/colorpicker/lightness_cielab_lr_l.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 0.75), 384px);" width="512"></p></div><p>From top to bottom: CIELab <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">L</span></span></span></span>, Oklab <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">L_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, Oklab <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">L</span></span></span></span>.</p></div></div><h2 id="introducing-two-new-color-spaces%3A-okhsv-and-okhsl">Introducing two new color spaces: Okhsv and Okhsl <a href="#introducing-two-new-color-spaces%3A-okhsv-and-okhsl" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h2><p>With this new lightness estimate, we are ready to look into the construction of Okhsv and Okhsl. Here is a rough overview of the general idea behind Okhsv and Okhsl and their construction. Some details are glossed over here, for all the details check out the source code <a href="#source-code">below</a>.</p><h3 id="okhsv">Okhsv <a href="#okhsv" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>To derive Okhsv, we will start with OkLCh, use its estimate for hue, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">h</span></span></span></span>, as is and introduce <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> parameters that are calculated based on lightness, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">L_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, and chroma, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span>. To keep the triangular shape when using <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">L_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> we also scale <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span> by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">L_r/L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">/</span><span class="mord mathit">L</span></span></span></span>.</p><p>Here is the sRGB gamut plotted for set of hues, with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">L_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> on the y-axis and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><msub><mi>L</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">C L_r/L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">/</span><span class="mord mathit">L</span></span></span></span> on the x-axis:</p><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="Yellow" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_1_sv_7.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Blue" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_1_sv_16.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Magenta" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_1_sv_22.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div></div><p>To create a HSV-like color space, we want to find a mapping so that the cusp of the triangle is in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">v=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span>. We also want to change the triangle shape into a square, by stretching the lower part of the triangle.</p><p>To find the cusp we can use the same method as in my previous post about <a href="https://bottosson.github.io/posts/gamutclipping/">sRGB gamut clipping</a>.</p><p>If we perform this remapping we get the following result:</p><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="Yellow" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_3_sv_7.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Blue" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_3_sv_16.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Magenta" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_3_sv_22.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div></div><p>Remaining now is a small curve at the top, that we also have to remove. This is done by scaling <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> to compensate. This step makes the space less uniform perceptually, but is needed to fit the sRGB gamut to a cylinder exactly. The change is quite small however. This gives the following result:</p><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="Yellow" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_4_sv_7.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Blue" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_4_sv_16.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Magenta" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_4_sv_22.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div></div><p>As an additional step we adjust saturation to be more uniform for low saturation colors. This makes it easier to compare saturation values for different colors, when saturation is low. The effect of this is subtle.</p><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="Yellow" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_5_sv_7.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Blue" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_5_sv_16.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Magenta" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsv_5_sv_22.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div></div><p>This gives us a new model with a simple geometrical shape and a hue parameter that closely matches perception. Overall the space will be very familiar to someone who is used to HSV, but with improved perceptual uniformity.</p><h4 id="okhwb">Okhwb <a href="#okhwb" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h4><p>If desired, Okhsv can also be converted to a HWB (hue, whiteness and blackness) form.</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>=</mo><mo>(</mo><mn>1</mn><mo>−</mo><mi>s</mi><mo>)</mo><mi>v</mi></mrow><annotation encoding="application/x-tex">w = (1-s) v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base displaystyle"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit">s</span><span class="mclose">)</span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mo>=</mo><mn>1</mn><mo>−</mo><mi>v</mi></mrow><annotation encoding="application/x-tex">b = 1-v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="textstyle uncramped base displaystyle"><span class="mord mathit">b</span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span></span></p><p>With the inverse:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>=</mo><mn>1</mn><mo>−</mo><mfrac><mrow><mi>w</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>b</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">s = 1-\frac{w}{1-b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.10756em;"></span><span class="strut bottom" style="height:1.8768900000000002em;vertical-align:-0.7693300000000001em;"></span><span class="textstyle uncramped base displaystyle"><span class="mord mathit">s</span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord textstyle uncramped reset-textstyle displaystyle"><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle reset-textstyle cramped"><span class="mord cramped textstyle"><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit">b</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle uncramped reset-textstyle frac-line"></span></span><span style="top:-0.677em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle uncramped reset-textstyle"><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi><mo>=</mo><mn>1</mn><mo>−</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">v = 1-b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="textstyle uncramped base displaystyle"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit">b</span></span></span></span></span></p><h3 id="okhsl">Okhsl <a href="#okhsl" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>To derive Okhsl we also start with OkLCh. <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">L_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">h</span></span></span></span> are kept as is, with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">L_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> referred to as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span> instead for consistency.</p><p>For <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span></span></span></span> we want to somehow remap <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span> so that the sRGB gamut nicely fits into a cylinder.</p><p>The simplest way to do this is to simply scale it by the maximum chroma inside the sRGB gamut for a given value of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">h</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>(</mo><mi>h</mi><mo separator="true">,</mo><mi>l</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">C_{max}(h, l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">h</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span>, which is what HSLuv does. As we have seen with HSLuv though, the unevenness of the shape of the gamut will affect the interior of the entire space resulting in an uneven scale for the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span></span></span></span> component.</p><p>Instead it would be good if we could find a way to keep the unevenness local to colors close to the edge of the gamut, leaving the interior less affected. This is the key idea behind Okhsl.</p><p>One way to solve this would be to solve it as a boundary value problem, finding <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mo>=</mo><mi>f</mi><mo>(</mo><mi>h</mi><mo separator="true">,</mo><mi>s</mi><mo separator="true">,</mo><mi>l</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">C = f(h, s, l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">h</span><span class="mpunct">,</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span>, with a boundary condition that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mo>=</mo><msub><mi>C</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>(</mo><mi>h</mi><mo separator="true">,</mo><mi>l</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">C = C_{max}(h, l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">h</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span> and some set of differential equation that keeps the interior smooth. This approach could definitely give a good result and would be interesting to explore, but is likely to only have a numerical solution, which would make it hard to use practically to construct a color space.</p><p>Instead Okhsl uses a fairly ad-hoc approach to create a smoothly varying interior, since that makes it efficient to run and easy to invert.</p><p>Instead of scaling <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span></span></span></span> by a single value for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span>, the max possible value in the gamut, three different values are used, one for low values of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">C_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, one for midrange values of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{mid}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> and one for large values, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>. These are constructed the following way:</p><ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub><mo>(</mo><mi>l</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">C_0(l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span> is constructed to be independent of hue, this way creating continuity for colors close to the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span> axis.</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub><mo>(</mo><mi>h</mi><mo separator="true">,</mo><mi>l</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">C_{mid}(h, l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">h</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span> is constructed to be closer in shape to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mi>m</mi></msub><mi>a</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">C_max</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span>, but still much smoother and has been constructed using an optimization process. See the source code for more details and the exact computation.</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>(</mo><mi>h</mi><mo separator="true">,</mo><mi>l</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">C_{max}(h, l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">h</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span> is the maximum possible value for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span> in the sRGB gamut for the given values of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">h</span></span></span></span></li></ul><p>To get an understanding of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">C_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{mid}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, here are a few hue slices where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span> is computed <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mo>=</mo><mi>s</mi><msub><mi>C</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">C = s C_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mrel">=</span><span class="mord mathit">s</span><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mo>=</mo><mi>s</mi><msub><mi>C</mi><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C = s C_{mid}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mrel">=</span><span class="mord mathit">s</span><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mo>=</mo><mi>s</mi><msub><mi>C</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C = s C_{max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mrel">=</span><span class="mord mathit">s</span><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> respectively.</p><div class="has-background-white-ter columns"><div class="column"><p><strong><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">C_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></strong></p></div><div class="column"><p><strong><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{mid}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></strong></p></div><div class="column"><p><strong><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></strong></p></div></div><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="Yellow C_0" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_0_sv_7.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Yellow C_mid" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_mid_sv_7.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Yellow C_max" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_max_sv_7.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div></div><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="Blue C_0" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_0_sv_16.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Blue C_mid" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_mid_sv_16.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Blue C_max" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_max_sv_16.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div></div><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="Magenta C_0" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_0_sv_22.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Magenta C_mid" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_mid_sv_22.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Magenta C_max" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_c_max_sv_22.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div></div><p>To create the full Okhsl model, the values are interpolated so that:</p><ul><li>At <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>C</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>s</mi></mrow></mfrac><mo>=</mo><msub><mi>C</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\frac{\partial C}{\partial s} = C_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8801079999999999em;"></span><span class="strut bottom" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="textstyle uncramped base"><span class="mord textstyle uncramped reset-textstyle"><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord mathit">s</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="textstyle uncramped reset-textstyle frac-line"></span></span><span style="top:-0.394em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="reset-size5 size5 nulldelimiter reset-textstyle sizing textstyle uncramped"></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">C=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span></li><li>At <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>=</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">s=0.8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span><span class="mrel">=</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">8</span></span></span></span>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mo>=</mo><msub><mi>C</mi><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C=C_{mid}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></li><li>At <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">.</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">s=1.0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="textstyle uncramped base"><span class="mord mathit">s</span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">0</span></span></span></span>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mo>=</mo><msub><mi>C</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C=C_{max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="textstyle uncramped base"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span><span class="reset-textstyle cramped scriptstyle"><span class="mord cramped scriptstyle"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span></span></span><span class="baseline-fix"><span class="reset-size5 size5 fontsize-ensurer"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></li></ul><p>This gives the final Okhsl model:</p><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="Yellow" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_sv_7.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Blue" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_sv_16.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div><div class="column"><div class="box has-background-grey-light"><p><img alt="Magenta" decoding="async" height="512" loading="lazy" src="/img/colorpicker/hsl_sv_22.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 512px) min(calc(var(--main-width) * 1), 512px);" width="512"></p></div></div></div><p>Altogether this gives a model with a simple geometrical shape that has parameters for lightness and hue that closely match perception. The model is quite different from regular HSL, in order to achieve a better lightness estimate. I believe Okhsl delivers a better overall compromise, and keeps many of the benefits of Lab-like color spaces, without the complexity of an irregular shape.</p><p>Here are a few examples of slices Okhsl, with constant lightness and saturation:</p><div class="has-background-white-ter columns"><div class="column"><div class="box has-background-grey-light"><p><img alt="HSLuv Constant Lightness" decoding="async" height="257" loading="lazy" src="/img/colorpicker/okhsl_circle.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>Example of constant “lightness” in HSLuv. The effect of the uneven shape of the gamut are contained to the edges.</p></div><div class="column"><div class="box has-background-grey-light"><p><img alt="HSLuv Constant Saturation" decoding="async" height="257" loading="lazy" src="/img/colorpicker/okhsl_s_slice.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>Slice of colors with constant “saturation” in HSLuv. While not matching perceived chroma fully it is smoothly varying.</p></div><div class="column"><div class="box has-background-grey-light"><p><img alt="HSLuv Constant Saturation" decoding="async" height="257" loading="lazy" src="/img/colorpicker/okhsl_s_slice_100.png" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 257px) min(calc(var(--main-width) * 1), 257px);" width="257"></p></div><p>For 100% ‘saturation’ the variation in perceived chroma is larger, due to the shape of the sRGB gamut.</p></div></div><h3 id="summary-2">Summary <a href="#summary-2" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>For completeness, here is a table of how Okhsv and Okhsl match the desired properties from earlier. Again, this is definitely a bit subjective. A better way to judge the performance is to just <a href="http://bottosson.github.io/misc/colorpicker">try the results yourself</a>.</p><table><thead><tr><th></th><th>Okhsv</th><th>Okhsl</th></tr></thead><tbody><tr><td>Orthogonal Lightness</td><td>no</td><td>yes</td></tr><tr><td>Orthogonal Chroma</td><td>no</td><td>no</td></tr><tr><td>Orthogonal Saturation</td><td>partial</td><td>no</td></tr><tr><td>Orthogonal Hue</td><td>yes</td><td>yes</td></tr><tr><td>Simple Geometrical Shape</td><td>yes</td><td>yes</td></tr><tr><td>Max Chroma at Edge</td><td>yes</td><td>no</td></tr><tr><td>Varies Smoothly</td><td>yes</td><td>yes</td></tr><tr><td>Varies Evenly</td><td>no</td><td>no</td></tr></tbody></table><h2 id="ideas-for-future-work">Ideas for future work <a href="#ideas-for-future-work" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h2><p>Okhsv and Okhsl are my attempts at making better color pickers for the sRGB gamut. I would love to see more experimentation overall with color picker design and in the next few years, color pickers for wide gamut and HDR will be more and more important and need a lot of research. They both offer their own new challenges.</p><p>Wide gamut is challenging since we are seeing an increased variety of different gamuts. At least for a while, target color spaces will be much more varied and applications for authoring colors will have to either settle for common subset or have to deal with this complexity. This of course will have a big impact on what color pickers look like and how they behave.</p><p>One interesting avenue to pursue would be to more automatically create color spaces like Okhsv and Okhsl for a given color gamut. This would likely need to use a bit of a different approach, maybe using lookup tables and numerical solutions in order to not need as much handcrafted logic.</p><p>HDR also has the issue of not being quite standardized, but an added complexity is the increased dynamic range and variation is absolute brightness. In the past color pickers have been able to mostly ignore how the eye adapts to different luminance levels, but this does not work as well with HDR. So far the approaches I’ve seen are to use regular SDR color pickers, but with and added exposure/intensity control. Is this the best approach or are there new ways we should be working with HDR color pickers?</p><p>An additional thing to explore is what spacing of hues would be the best. Okhsl and Okhsv simply inherit their spacing from Oklab. A different option could be to do a remapping similar to NCS, which would make the parameter vary less evenly, but could make it easier to use by mapping the different axes to more familiar colors.</p><h2 id="source-code">Source Code <a href="#source-code" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h2><p>Here is the Source Code for conversion between sRGB, HSL and HSV. This code depends on the code from my previous post <a href="https://bottosson.github.io/posts/gamutclipping/">sRGB gamut clipping</a>, which is not included here. You can find the source for both posts combined <a href="http://bottosson.github.io/misc/ok_color.h">here</a> as a C++ header.</p><p>The <a href="http://bottosson.github.io/misc/colorpicker">interactive comparison of color pickers</a> also has an implementation of this in JavaScript. The source is available <a href="https://github.com/bottosson/bottosson.github.io/tree/master/misc/colorpicker">here</a>.</p><h3 id="license">License <a href="#license" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>All the source code on this page is provided under the MIT license:</p><pre><code>Copyright (c) 2021 Björn Ottosson

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</code></pre><h3 id="common-code">Common code <a href="#common-code" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">HSV</span> <span class="token punctuation">{</span> <span class="token keyword">float</span> h<span class="token punctuation">;</span> <span class="token keyword">float</span> s<span class="token punctuation">;</span> <span class="token keyword">float</span> v<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">struct</span> <span class="token class-name">HSL</span> <span class="token punctuation">{</span> <span class="token keyword">float</span> h<span class="token punctuation">;</span> <span class="token keyword">float</span> s<span class="token punctuation">;</span> <span class="token keyword">float</span> l<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">struct</span> <span class="token class-name">LC</span> <span class="token punctuation">{</span> <span class="token keyword">float</span> L<span class="token punctuation">;</span> <span class="token keyword">float</span> C<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Alternative representation of (L_cusp, C_cusp)</span><br><span class="token comment">// Encoded so S = C_cusp/L_cusp and T = C_cusp/(1-L_cusp) </span><br><span class="token comment">// The maximum value for C in the triangle is then found as fmin(S*L, T*(1-L)), for a given L</span><br><span class="token keyword">struct</span> <span class="token class-name">ST</span> <span class="token punctuation">{</span> <span class="token keyword">float</span> S<span class="token punctuation">;</span> <span class="token keyword">float</span> T<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// toe function for L_r</span><br><span class="token keyword">float</span> <span class="token function">toe</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	<span class="token keyword">constexpr</span> <span class="token keyword">float</span> k_1 <span class="token operator">=</span> <span class="token number">0.206f</span><span class="token punctuation">;</span><br>	<span class="token keyword">constexpr</span> <span class="token keyword">float</span> k_2 <span class="token operator">=</span> <span class="token number">0.03f</span><span class="token punctuation">;</span><br>	<span class="token keyword">constexpr</span> <span class="token keyword">float</span> k_3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">+</span> k_1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">+</span> k_2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token number">0.5f</span> <span class="token operator">*</span> <span class="token punctuation">(</span>k_3 <span class="token operator">*</span> x <span class="token operator">-</span> k_1 <span class="token operator">+</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k_3 <span class="token operator">*</span> x <span class="token operator">-</span> k_1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>k_3 <span class="token operator">*</span> x <span class="token operator">-</span> k_1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> k_2 <span class="token operator">*</span> k_3 <span class="token operator">*</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// inverse toe function for L_r</span><br><span class="token keyword">float</span> <span class="token function">toe_inv</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	<span class="token keyword">constexpr</span> <span class="token keyword">float</span> k_1 <span class="token operator">=</span> <span class="token number">0.206f</span><span class="token punctuation">;</span><br>	<span class="token keyword">constexpr</span> <span class="token keyword">float</span> k_2 <span class="token operator">=</span> <span class="token number">0.03f</span><span class="token punctuation">;</span><br>	<span class="token keyword">constexpr</span> <span class="token keyword">float</span> k_3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">+</span> k_1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">+</span> k_2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token operator">+</span> k_1 <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>k_3 <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> k_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>ST <span class="token function">to_ST</span><span class="token punctuation">(</span>LC cusp<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	<span class="token keyword">float</span> L <span class="token operator">=</span> cusp<span class="token punctuation">.</span>L<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C <span class="token operator">=</span> cusp<span class="token punctuation">.</span>C<span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> C <span class="token operator">/</span> L<span class="token punctuation">,</span> C <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> L<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre><h3 id="hsv-2">HSV <a href="#hsv-2" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>This code converts between sRGB (not linear) and Okhsv.</p><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">HSV</span> <span class="token punctuation">{</span> <span class="token keyword">float</span> h<span class="token punctuation">;</span> <span class="token keyword">float</span> s<span class="token punctuation">;</span> <span class="token keyword">float</span> v<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>RGB <span class="token function">okhsv_to_srgb</span><span class="token punctuation">(</span>HSV hsv<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	<span class="token keyword">float</span> h <span class="token operator">=</span> hsv<span class="token punctuation">.</span>h<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> s <span class="token operator">=</span> hsv<span class="token punctuation">.</span>s<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> v <span class="token operator">=</span> hsv<span class="token punctuation">.</span>v<span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> a_ <span class="token operator">=</span> <span class="token function">cosf</span><span class="token punctuation">(</span><span class="token number">2.f</span> <span class="token operator">*</span> pi <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> b_ <span class="token operator">=</span> <span class="token function">sinf</span><span class="token punctuation">(</span><span class="token number">2.f</span> <span class="token operator">*</span> pi <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<br>	LC cusp <span class="token operator">=</span> <span class="token function">find_cusp</span><span class="token punctuation">(</span>a_<span class="token punctuation">,</span> b_<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	ST ST_max <span class="token operator">=</span> <span class="token function">to_ST</span><span class="token punctuation">(</span>cusp<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> S_max <span class="token operator">=</span> ST_max<span class="token punctuation">.</span>S<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> T_max <span class="token operator">=</span> ST_max<span class="token punctuation">.</span>T<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> S_0 <span class="token operator">=</span> <span class="token number">0.5f</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> k <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> S_0 <span class="token operator">/</span> S_max<span class="token punctuation">;</span><br><br>	<span class="token comment">// first we compute L and V as if the gamut is a perfect triangle:</span><br><br>	<span class="token comment">// L, C when v==1:</span><br>	<span class="token keyword">float</span> L_v <span class="token operator">=</span> <span class="token number">1</span>     <span class="token operator">-</span> s <span class="token operator">*</span> S_0 <span class="token operator">/</span> <span class="token punctuation">(</span>S_0 <span class="token operator">+</span> T_max <span class="token operator">-</span> T_max <span class="token operator">*</span> k <span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_v <span class="token operator">=</span> s <span class="token operator">*</span> T_max <span class="token operator">*</span> S_0 <span class="token operator">/</span> <span class="token punctuation">(</span>S_0 <span class="token operator">+</span> T_max <span class="token operator">-</span> T_max <span class="token operator">*</span> k <span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> L <span class="token operator">=</span> v <span class="token operator">*</span> L_v<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C <span class="token operator">=</span> v <span class="token operator">*</span> C_v<span class="token punctuation">;</span><br><br>	<span class="token comment">// then we compensate for both toe and the curved top part of the triangle:</span><br>	<span class="token keyword">float</span> L_vt <span class="token operator">=</span> <span class="token function">toe_inv</span><span class="token punctuation">(</span>L_v<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_vt <span class="token operator">=</span> C_v <span class="token operator">*</span> L_vt <span class="token operator">/</span> L_v<span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> L_new <span class="token operator">=</span> <span class="token function">toe_inv</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	C <span class="token operator">=</span> C <span class="token operator">*</span> L_new <span class="token operator">/</span> L<span class="token punctuation">;</span><br>	L <span class="token operator">=</span> L_new<span class="token punctuation">;</span><br><br>	RGB rgb_scale <span class="token operator">=</span> <span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span><span class="token punctuation">{</span> L_vt<span class="token punctuation">,</span> a_ <span class="token operator">*</span> C_vt<span class="token punctuation">,</span> b_ <span class="token operator">*</span> C_vt <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> scale_L <span class="token operator">=</span> <span class="token function">cbrtf</span><span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">/</span> <span class="token function">fmax</span><span class="token punctuation">(</span><span class="token function">fmax</span><span class="token punctuation">(</span>rgb_scale<span class="token punctuation">.</span>r<span class="token punctuation">,</span> rgb_scale<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fmax</span><span class="token punctuation">(</span>rgb_scale<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	L <span class="token operator">=</span> L <span class="token operator">*</span> scale_L<span class="token punctuation">;</span><br>	C <span class="token operator">=</span> C <span class="token operator">*</span> scale_L<span class="token punctuation">;</span><br><br>	RGB rgb <span class="token operator">=</span> <span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span><span class="token punctuation">{</span> L<span class="token punctuation">,</span> C <span class="token operator">*</span> a_<span class="token punctuation">,</span> C <span class="token operator">*</span> b_ <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span><br>		<span class="token function">srgb_transfer_function</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token function">srgb_transfer_function</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token function">srgb_transfer_function</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>HSV <span class="token function">srgb_to_okhsv</span><span class="token punctuation">(</span>RGB rgb<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	Lab lab <span class="token operator">=</span> <span class="token function">linear_srgb_to_oklab</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>		<span class="token function">srgb_transfer_function_inv</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token function">srgb_transfer_function_inv</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token function">srgb_transfer_function_inv</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>b<span class="token punctuation">)</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> C <span class="token operator">=</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span>lab<span class="token punctuation">.</span>a <span class="token operator">*</span> lab<span class="token punctuation">.</span>a <span class="token operator">+</span> lab<span class="token punctuation">.</span>b <span class="token operator">*</span> lab<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> a_ <span class="token operator">=</span> lab<span class="token punctuation">.</span>a <span class="token operator">/</span> C<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> b_ <span class="token operator">=</span> lab<span class="token punctuation">.</span>b <span class="token operator">/</span> C<span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> L <span class="token operator">=</span> lab<span class="token punctuation">.</span>L<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> h <span class="token operator">=</span> <span class="token number">0.5f</span> <span class="token operator">+</span> <span class="token number">0.5f</span> <span class="token operator">*</span> <span class="token function">atan2f</span><span class="token punctuation">(</span><span class="token operator">-</span>lab<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token operator">-</span>lab<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token operator">/</span> pi<span class="token punctuation">;</span><br><br>	LC cusp <span class="token operator">=</span> <span class="token function">find_cusp</span><span class="token punctuation">(</span>a_<span class="token punctuation">,</span> b_<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	ST ST_max <span class="token operator">=</span> <span class="token function">to_ST</span><span class="token punctuation">(</span>cusp<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> S_max <span class="token operator">=</span> ST_max<span class="token punctuation">.</span>S<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> T_max <span class="token operator">=</span> ST_max<span class="token punctuation">.</span>T<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> S_0 <span class="token operator">=</span> <span class="token number">0.5f</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> k <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> S_0 <span class="token operator">/</span> S_max<span class="token punctuation">;</span><br><br>	<span class="token comment">// first we find L_v, C_v, L_vt and C_vt</span><br><br>	<span class="token keyword">float</span> t <span class="token operator">=</span> T_max <span class="token operator">/</span> <span class="token punctuation">(</span>C <span class="token operator">+</span> L <span class="token operator">*</span> T_max<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> L_v <span class="token operator">=</span> t <span class="token operator">*</span> L<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_v <span class="token operator">=</span> t <span class="token operator">*</span> C<span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> L_vt <span class="token operator">=</span> <span class="token function">toe_inv</span><span class="token punctuation">(</span>L_v<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_vt <span class="token operator">=</span> C_v <span class="token operator">*</span> L_vt <span class="token operator">/</span> L_v<span class="token punctuation">;</span><br><br>	<span class="token comment">// we can then use these to invert the step that compensates for the toe and the curved top part of the triangle:</span><br>	RGB rgb_scale <span class="token operator">=</span> <span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span><span class="token punctuation">{</span> L_vt<span class="token punctuation">,</span> a_ <span class="token operator">*</span> C_vt<span class="token punctuation">,</span> b_ <span class="token operator">*</span> C_vt <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> scale_L <span class="token operator">=</span> <span class="token function">cbrtf</span><span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">/</span> <span class="token function">fmax</span><span class="token punctuation">(</span><span class="token function">fmax</span><span class="token punctuation">(</span>rgb_scale<span class="token punctuation">.</span>r<span class="token punctuation">,</span> rgb_scale<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fmax</span><span class="token punctuation">(</span>rgb_scale<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	L <span class="token operator">=</span> L <span class="token operator">/</span> scale_L<span class="token punctuation">;</span><br>	C <span class="token operator">=</span> C <span class="token operator">/</span> scale_L<span class="token punctuation">;</span><br><br>	C <span class="token operator">=</span> C <span class="token operator">*</span> <span class="token function">toe</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">/</span> L<span class="token punctuation">;</span><br>	L <span class="token operator">=</span> <span class="token function">toe</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token comment">// we can now compute v and s:</span><br><br>	<span class="token keyword">float</span> v <span class="token operator">=</span> L <span class="token operator">/</span> L_v<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> s <span class="token operator">=</span> <span class="token punctuation">(</span>S_0 <span class="token operator">+</span> T_max<span class="token punctuation">)</span> <span class="token operator">*</span> C_v <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>T_max <span class="token operator">*</span> S_0<span class="token punctuation">)</span> <span class="token operator">+</span> T_max <span class="token operator">*</span> k <span class="token operator">*</span> C_v<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> v <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre><h3 id="hsl-2">HSL <a href="#hsl-2" class="anchor-link"><span class="icon is-small"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>This code converts between sRGB (not linear) and Okhsl.</p><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">HSL</span> <span class="token punctuation">{</span> <span class="token keyword">float</span> h<span class="token punctuation">;</span> <span class="token keyword">float</span> s<span class="token punctuation">;</span> <span class="token keyword">float</span> l<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Returns a smooth approximation of the location of the cusp</span><br><span class="token comment">// This polynomial was created by an optimization process</span><br><span class="token comment">// It has been designed so that S_mid &lt; S_max and T_mid &lt; T_max</span><br>ST <span class="token function">get_ST_mid</span><span class="token punctuation">(</span><span class="token keyword">float</span> a_<span class="token punctuation">,</span> <span class="token keyword">float</span> b_<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	<span class="token keyword">float</span> S <span class="token operator">=</span> <span class="token number">0.11516993f</span> <span class="token operator">+</span> <span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><br>		<span class="token operator">+</span><span class="token number">7.44778970f</span> <span class="token operator">+</span> <span class="token number">4.15901240f</span> <span class="token operator">*</span> b_<br>		<span class="token operator">+</span> a_ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.19557347f</span> <span class="token operator">+</span> <span class="token number">1.75198401f</span> <span class="token operator">*</span> b_<br>			<span class="token operator">+</span> a_ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.13704948f</span> <span class="token operator">-</span> <span class="token number">10.02301043f</span> <span class="token operator">*</span> b_<br>				<span class="token operator">+</span> a_ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4.24894561f</span> <span class="token operator">+</span> <span class="token number">5.38770819f</span> <span class="token operator">*</span> b_ <span class="token operator">+</span> <span class="token number">4.69891013f</span> <span class="token operator">*</span> a_<br>					<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>		<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> T <span class="token operator">=</span> <span class="token number">0.11239642f</span> <span class="token operator">+</span> <span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><br>		<span class="token operator">+</span><span class="token number">1.61320320f</span> <span class="token operator">-</span> <span class="token number">0.68124379f</span> <span class="token operator">*</span> b_<br>		<span class="token operator">+</span> a_ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0.40370612f</span> <span class="token operator">+</span> <span class="token number">0.90148123f</span> <span class="token operator">*</span> b_<br>			<span class="token operator">+</span> a_ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.27087943f</span> <span class="token operator">+</span> <span class="token number">0.61223990f</span> <span class="token operator">*</span> b_<br>				<span class="token operator">+</span> a_ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0.00299215f</span> <span class="token operator">-</span> <span class="token number">0.45399568f</span> <span class="token operator">*</span> b_ <span class="token operator">-</span> <span class="token number">0.14661872f</span> <span class="token operator">*</span> a_<br>					<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>		<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> S<span class="token punctuation">,</span> T <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">Cs</span> <span class="token punctuation">{</span> <span class="token keyword">float</span> C_0<span class="token punctuation">;</span> <span class="token keyword">float</span> C_mid<span class="token punctuation">;</span> <span class="token keyword">float</span> C_max<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>Cs <span class="token function">get_Cs</span><span class="token punctuation">(</span><span class="token keyword">float</span> L<span class="token punctuation">,</span> <span class="token keyword">float</span> a_<span class="token punctuation">,</span> <span class="token keyword">float</span> b_<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	LC cusp <span class="token operator">=</span> <span class="token function">find_cusp</span><span class="token punctuation">(</span>a_<span class="token punctuation">,</span> b_<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> C_max <span class="token operator">=</span> <span class="token function">find_gamut_intersection</span><span class="token punctuation">(</span>a_<span class="token punctuation">,</span> b_<span class="token punctuation">,</span> L<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> L<span class="token punctuation">,</span> cusp<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	ST ST_max <span class="token operator">=</span> <span class="token function">to_ST</span><span class="token punctuation">(</span>cusp<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<br>	<span class="token comment">// Scale factor to compensate for the curved part of gamut shape:</span><br>	<span class="token keyword">float</span> k <span class="token operator">=</span> C_max <span class="token operator">/</span> <span class="token function">fmin</span><span class="token punctuation">(</span><span class="token punctuation">(</span>L <span class="token operator">*</span> ST_max<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> L<span class="token punctuation">)</span> <span class="token operator">*</span> ST_max<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> C_mid<span class="token punctuation">;</span><br>	<span class="token punctuation">{</span><br>		ST ST_mid <span class="token operator">=</span> <span class="token function">get_ST_mid</span><span class="token punctuation">(</span>a_<span class="token punctuation">,</span> b_<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		<span class="token comment">// Use a soft minimum function, instead of a sharp triangle shape to get a smooth value for chroma.</span><br>		<span class="token keyword">float</span> C_a <span class="token operator">=</span> L <span class="token operator">*</span> ST_mid<span class="token punctuation">.</span>S<span class="token punctuation">;</span><br>		<span class="token keyword">float</span> C_b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> L<span class="token punctuation">)</span> <span class="token operator">*</span> ST_mid<span class="token punctuation">.</span>T<span class="token punctuation">;</span><br>		C_mid <span class="token operator">=</span> <span class="token number">0.9f</span> <span class="token operator">*</span> k <span class="token operator">*</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span><span class="token function">sqrtf</span><span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span>C_a <span class="token operator">*</span> C_a <span class="token operator">*</span> C_a <span class="token operator">*</span> C_a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span>C_b <span class="token operator">*</span> C_b <span class="token operator">*</span> C_b <span class="token operator">*</span> C_b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br>	<span class="token keyword">float</span> C_0<span class="token punctuation">;</span><br>	<span class="token punctuation">{</span><br>		<span class="token comment">// for C_0, the shape is independent of hue, so ST are constant. Values picked to roughly be the average values of ST.</span><br>		<span class="token keyword">float</span> C_a <span class="token operator">=</span> L <span class="token operator">*</span> <span class="token number">0.4f</span><span class="token punctuation">;</span><br>		<span class="token keyword">float</span> C_b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> L<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.8f</span><span class="token punctuation">;</span><br><br>		<span class="token comment">// Use a soft minimum function, instead of a sharp triangle shape to get a smooth value for chroma.</span><br>		C_0 <span class="token operator">=</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span>C_a <span class="token operator">*</span> C_a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span>C_b <span class="token operator">*</span> C_b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> C_0<span class="token punctuation">,</span> C_mid<span class="token punctuation">,</span> C_max <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>RGB <span class="token function">okhsl_to_srgb</span><span class="token punctuation">(</span>HSL hsl<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	<span class="token keyword">float</span> h <span class="token operator">=</span> hsl<span class="token punctuation">.</span>h<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> s <span class="token operator">=</span> hsl<span class="token punctuation">.</span>s<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> l <span class="token operator">=</span> hsl<span class="token punctuation">.</span>l<span class="token punctuation">;</span><br><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">==</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><br>	<span class="token punctuation">{</span><br>		<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token number">1.f</span><span class="token punctuation">,</span> <span class="token number">1.f</span><span class="token punctuation">,</span> <span class="token number">1.f</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br>	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">==</span> <span class="token number">0.f</span><span class="token punctuation">)</span><br>	<span class="token punctuation">{</span><br>		<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">0.f</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br>	<span class="token keyword">float</span> a_ <span class="token operator">=</span> <span class="token function">cosf</span><span class="token punctuation">(</span><span class="token number">2.f</span> <span class="token operator">*</span> pi <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> b_ <span class="token operator">=</span> <span class="token function">sinf</span><span class="token punctuation">(</span><span class="token number">2.f</span> <span class="token operator">*</span> pi <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> L <span class="token operator">=</span> <span class="token function">toe_inv</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	Cs cs <span class="token operator">=</span> <span class="token function">get_Cs</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> a_<span class="token punctuation">,</span> b_<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_0 <span class="token operator">=</span> cs<span class="token punctuation">.</span>C_0<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_mid <span class="token operator">=</span> cs<span class="token punctuation">.</span>C_mid<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_max <span class="token operator">=</span> cs<span class="token punctuation">.</span>C_max<span class="token punctuation">;</span><br><br>    <span class="token comment">// Interpolate the three values for C so that:</span><br>    <span class="token comment">// At s=0: dC/ds = C_0, C=0</span><br>    <span class="token comment">// At s=0.8: C=C_mid</span><br>    <span class="token comment">// At s=1.0: C=C_max</span><br><br>	<span class="token keyword">float</span> mid <span class="token operator">=</span> <span class="token number">0.8f</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> mid_inv <span class="token operator">=</span> <span class="token number">1.25f</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> C<span class="token punctuation">,</span> t<span class="token punctuation">,</span> k_0<span class="token punctuation">,</span> k_1<span class="token punctuation">,</span> k_2<span class="token punctuation">;</span><br><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&lt;</span> mid<span class="token punctuation">)</span><br>	<span class="token punctuation">{</span><br>		t <span class="token operator">=</span> mid_inv <span class="token operator">*</span> s<span class="token punctuation">;</span><br><br>		k_1 <span class="token operator">=</span> mid <span class="token operator">*</span> C_0<span class="token punctuation">;</span><br>		k_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> k_1 <span class="token operator">/</span> C_mid<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		C <span class="token operator">=</span> t <span class="token operator">*</span> k_1 <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> k_2 <span class="token operator">*</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br>	<span class="token keyword">else</span><br>	<span class="token punctuation">{</span><br>		t <span class="token operator">=</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		k_0 <span class="token operator">=</span> C_mid<span class="token punctuation">;</span><br>		k_1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> mid<span class="token punctuation">)</span> <span class="token operator">*</span> C_mid <span class="token operator">*</span> C_mid <span class="token operator">*</span> mid_inv <span class="token operator">*</span> mid_inv <span class="token operator">/</span> C_0<span class="token punctuation">;</span><br>		k_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> <span class="token punctuation">(</span>k_1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>C_max <span class="token operator">-</span> C_mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		C <span class="token operator">=</span> k_0 <span class="token operator">+</span> t <span class="token operator">*</span> k_1 <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> k_2 <span class="token operator">*</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br>	RGB rgb <span class="token operator">=</span> <span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span><span class="token punctuation">{</span> L<span class="token punctuation">,</span> C <span class="token operator">*</span> a_<span class="token punctuation">,</span> C <span class="token operator">*</span> b_ <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span><br>		<span class="token function">srgb_transfer_function</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token function">srgb_transfer_function</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token function">srgb_transfer_function</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>HSL <span class="token function">srgb_to_okhsl</span><span class="token punctuation">(</span>RGB rgb<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>	Lab lab <span class="token operator">=</span> <span class="token function">linear_srgb_to_oklab</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>		<span class="token function">srgb_transfer_function_inv</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token function">srgb_transfer_function_inv</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token function">srgb_transfer_function_inv</span><span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>b<span class="token punctuation">)</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> C <span class="token operator">=</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span>lab<span class="token punctuation">.</span>a <span class="token operator">*</span> lab<span class="token punctuation">.</span>a <span class="token operator">+</span> lab<span class="token punctuation">.</span>b <span class="token operator">*</span> lab<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> a_ <span class="token operator">=</span> lab<span class="token punctuation">.</span>a <span class="token operator">/</span> C<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> b_ <span class="token operator">=</span> lab<span class="token punctuation">.</span>b <span class="token operator">/</span> C<span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> L <span class="token operator">=</span> lab<span class="token punctuation">.</span>L<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> h <span class="token operator">=</span> <span class="token number">0.5f</span> <span class="token operator">+</span> <span class="token number">0.5f</span> <span class="token operator">*</span> <span class="token function">atan2f</span><span class="token punctuation">(</span><span class="token operator">-</span>lab<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token operator">-</span>lab<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token operator">/</span> pi<span class="token punctuation">;</span><br><br>	Cs cs <span class="token operator">=</span> <span class="token function">get_Cs</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> a_<span class="token punctuation">,</span> b_<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_0 <span class="token operator">=</span> cs<span class="token punctuation">.</span>C_0<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_mid <span class="token operator">=</span> cs<span class="token punctuation">.</span>C_mid<span class="token punctuation">;</span><br>	<span class="token keyword">float</span> C_max <span class="token operator">=</span> cs<span class="token punctuation">.</span>C_max<span class="token punctuation">;</span><br><br>    <span class="token comment">// Inverse of the interpolation in okhsl_to_srgb:</span><br><br>	<span class="token keyword">float</span> mid <span class="token operator">=</span> <span class="token number">0.8f</span><span class="token punctuation">;</span><br>	<span class="token keyword">float</span> mid_inv <span class="token operator">=</span> <span class="token number">1.25f</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">float</span> s<span class="token punctuation">;</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>C <span class="token operator">&lt;</span> C_mid<span class="token punctuation">)</span><br>	<span class="token punctuation">{</span><br>		<span class="token keyword">float</span> k_1 <span class="token operator">=</span> mid <span class="token operator">*</span> C_0<span class="token punctuation">;</span><br>		<span class="token keyword">float</span> k_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> k_1 <span class="token operator">/</span> C_mid<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		<span class="token keyword">float</span> t <span class="token operator">=</span> C <span class="token operator">/</span> <span class="token punctuation">(</span>k_1 <span class="token operator">+</span> k_2 <span class="token operator">*</span> C<span class="token punctuation">)</span><span class="token punctuation">;</span><br>		s <span class="token operator">=</span> t <span class="token operator">*</span> mid<span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br>	<span class="token keyword">else</span><br>	<span class="token punctuation">{</span><br>		<span class="token keyword">float</span> k_0 <span class="token operator">=</span> C_mid<span class="token punctuation">;</span><br>		<span class="token keyword">float</span> k_1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> mid<span class="token punctuation">)</span> <span class="token operator">*</span> C_mid <span class="token operator">*</span> C_mid <span class="token operator">*</span> mid_inv <span class="token operator">*</span> mid_inv <span class="token operator">/</span> C_0<span class="token punctuation">;</span><br>		<span class="token keyword">float</span> k_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> <span class="token punctuation">(</span>k_1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>C_max <span class="token operator">-</span> C_mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		<span class="token keyword">float</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>C <span class="token operator">-</span> k_0<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>k_1 <span class="token operator">+</span> k_2 <span class="token operator">*</span> <span class="token punctuation">(</span>C <span class="token operator">-</span> k_0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		s <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">-</span> mid<span class="token punctuation">)</span> <span class="token operator">*</span> t<span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br>	<span class="token keyword">float</span> l <span class="token operator">=</span> <span class="token function">toe</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> l <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre><hr><p>If you liked this article, it would be great if you considered sharing it:</p><div class="buttons"><a href="https://twitter.com/intent/tweet/?text=Two%20new%20color%20spaces%20for%20color%20picking%20-%20Okhsv%20and%20Okhsl&amp;url=https%3A%2F%2Fbottosson.github.io%2Fposts%2Fcolorpicker%2F" class="is-small button resp-sharing-button--twitter" rel="noopener" target="_blank" aria-label="Share on Twitter"><span class="icon resp-sharing-button__icon resp-sharing-button__icon--solid"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"></path></svg> </span></a><a href="mailto:?subject=Two%20new%20color%20spaces%20for%20color%20picking%20-%20Okhsv%20and%20Okhsl&amp;body=https%3A%2F%2Fbottosson.github.io%2Fposts%2Fcolorpicker%2F" class="is-small button resp-sharing-button--email" rel="noopener" target="_self" aria-label="Share by E-Mail"><span class="icon resp-sharing-button__icon resp-sharing-button__icon--solid"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"></path></svg> </span></a><a href="https://reddit.com/submit/?url=https%3A%2F%2Fbottosson.github.io%2Fposts%2Fcolorpicker%2F&amp;resubmit=true&amp;title=Two%20new%20color%20spaces%20for%20color%20picking%20-%20Okhsv%20and%20Okhsl" class="is-small button resp-sharing-button--reddit" rel="noopener" target="_blank" aria-label="Share on Reddit"><span class="icon resp-sharing-button__icon resp-sharing-button__icon--solid"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"></path></svg> </span></a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fbottosson.github.io%2Fposts%2Fcolorpicker%2F&amp;t=Two%20new%20color%20spaces%20for%20color%20picking%20-%20Okhsv%20and%20Okhsl" class="is-small button resp-sharing-button--hackernews" rel="noopener" target="_blank" aria-label="Share on Hacker News"><span class="icon resp-sharing-button__icon resp-sharing-button__icon--solid"><svg viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z" fill-rule="evenodd"></path></svg> </span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fbottosson.github.io%2Fposts%2Fcolorpicker%2F&amp;title=Two%20new%20color%20spaces%20for%20color%20picking%20-%20Okhsv%20and%20Okhsl&amp;source=https%3A%2F%2Fbottosson.github.io%2Fposts%2Fcolorpicker%2F" class="is-small button resp-sharing-button--linkedin" rel="noopener" target="_blank" aria-label="Share on LinkedIn"><span class="icon resp-sharing-button__icon resp-sharing-button__icon--solid"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"></path></svg> </span></a><a href="https://facebook.com/sharer/sharer.php?u=https%3A%2F%2Fbottosson.github.io%2Fposts%2Fcolorpicker%2F" class="is-small button resp-sharing-button--facebook" rel="noopener" target="_blank" aria-label="Share on Facebook"><span class="icon resp-sharing-button__icon resp-sharing-button__icon--solid"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"></path></svg></span></a></div><p></p><p>For discussions and feedback, <a href="https://twitter.com/bjornornorn" rel="noopener" target="_blank">ping me on Twitter.</a></p><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Two new color spaces for color picking - Okhsv and Okhsl","image":["https://bottosson.github.io/img/colorpicker/hsv-picker.png","https://bottosson.github.io/img/colorpicker/hsl-picker.png","https://bottosson.github.io/img/colorpicker/846px-Munsell_color-tree_hg.jpg","https://bottosson.github.io/img/colorpicker/ncs_color_picker.png","https://bottosson.github.io/img/colorpicker/hsv_blue.png","https://bottosson.github.io/img/colorpicker/hsl_blue.png","https://bottosson.github.io/img/colorpicker/hsl_ligthness.png","https://bottosson.github.io/img/colorpicker/hsluv_blue.png","https://bottosson.github.io/img/colorpicker/hsluv_uneven_s_circle.png","https://bottosson.github.io/img/colorpicker/hsluv_uneven_s_slice.png","https://bottosson.github.io/img/colorpicker/oklrab_blue.png","https://bottosson.github.io/img/colorpicker/oklrab_yellow.png","https://bottosson.github.io/img/colorpicker/lightness_cielab_lr_l.png","https://bottosson.github.io/img/colorpicker/hsv_1_sv_7.png","https://bottosson.github.io/img/colorpicker/hsv_1_sv_16.png","https://bottosson.github.io/img/colorpicker/hsv_1_sv_22.png","https://bottosson.github.io/img/colorpicker/hsv_3_sv_7.png","https://bottosson.github.io/img/colorpicker/hsv_3_sv_16.png","https://bottosson.github.io/img/colorpicker/hsv_3_sv_22.png","https://bottosson.github.io/img/colorpicker/hsv_4_sv_7.png","https://bottosson.github.io/img/colorpicker/hsv_4_sv_16.png","https://bottosson.github.io/img/colorpicker/hsv_4_sv_22.png","https://bottosson.github.io/img/colorpicker/hsv_5_sv_7.png","https://bottosson.github.io/img/colorpicker/hsv_5_sv_16.png","https://bottosson.github.io/img/colorpicker/hsv_5_sv_22.png","https://bottosson.github.io/img/colorpicker/hsl_c_0_sv_7.png","https://bottosson.github.io/img/colorpicker/hsl_c_mid_sv_7.png","https://bottosson.github.io/img/colorpicker/hsl_c_max_sv_7.png","https://bottosson.github.io/img/colorpicker/hsl_c_0_sv_16.png","https://bottosson.github.io/img/colorpicker/hsl_c_mid_sv_16.png","https://bottosson.github.io/img/colorpicker/hsl_c_max_sv_16.png","https://bottosson.github.io/img/colorpicker/hsl_c_0_sv_22.png","https://bottosson.github.io/img/colorpicker/hsl_c_mid_sv_22.png","https://bottosson.github.io/img/colorpicker/hsl_c_max_sv_22.png","https://bottosson.github.io/img/colorpicker/hsl_sv_7.png","https://bottosson.github.io/img/colorpicker/hsl_sv_16.png","https://bottosson.github.io/img/colorpicker/hsl_sv_22.png","https://bottosson.github.io/img/colorpicker/okhsl_circle.png","https://bottosson.github.io/img/colorpicker/okhsl_s_slice.png","https://bottosson.github.io/img/colorpicker/okhsl_s_slice_100.png"],"author":"Björn Ottosson","genre":"","publisher":{"@type":"Organization","name":"Björn Ottosson","logo":{"@type":"ImageObject","url":"/img/favicon/favicon-192x192.png?hash=98293e6f87"}},"url":"https://bottosson.github.io/posts/colorpicker/","mainEntityOfPage":"https://bottosson.github.io/posts/colorpicker/","datePublished":"2021-09-08","dateModified":"2021-09-08","description":"Okhsv and Okhsl Two new color spaces for color picking This post has an accompanying interactive comparison of color pickers. I would..."}</script><p>Published <time datetime="2021-09-08">08 Sep 2021</time></p></div></article></main></body></html>